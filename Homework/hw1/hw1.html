<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-02-01">

<title>Homework 1 — EDA and Visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="hw1_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw1_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="hw1_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="hw1_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="hw1_files/libs/quarto-html/popper.min.js"></script>
<script src="hw1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw1_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw1_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw1_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="hw1_files/libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="hw1_files/libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script type="module" src="hw1_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="hw1_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#primary-question" id="toc-primary-question" class="nav-link active" data-scroll-target="#primary-question">Primary Question</a></li>
  <li><a href="#environment-setup" id="toc-environment-setup" class="nav-link" data-scroll-target="#environment-setup">Environment Setup</a></li>
  <li><a href="#step-1.-read-in-the-data" id="toc-step-1.-read-in-the-data" class="nav-link" data-scroll-target="#step-1.-read-in-the-data">Step 1. Read in the data</a>
  <ul class="collapse">
  <li><a href="#read-the-data-with-only-the-needed-columns" id="toc-read-the-data-with-only-the-needed-columns" class="nav-link" data-scroll-target="#read-the-data-with-only-the-needed-columns">1.1 Read the data with only the needed columns</a></li>
  <li><a href="#check-the-data-dimensions-and-memory" id="toc-check-the-data-dimensions-and-memory" class="nav-link" data-scroll-target="#check-the-data-dimensions-and-memory">1.2 Check the data dimensions and memory</a></li>
  <li><a href="#check-the-data-types" id="toc-check-the-data-types" class="nav-link" data-scroll-target="#check-the-data-types">1.3 Check the data types</a></li>
  <li><a href="#check-the-missing-values" id="toc-check-the-missing-values" class="nav-link" data-scroll-target="#check-the-missing-values">1.4 Check the missing values</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">1.5 Summary</a></li>
  </ul></li>
  <li><a href="#step-2.-preprocess-the-data" id="toc-step-2.-preprocess-the-data" class="nav-link" data-scroll-target="#step-2.-preprocess-the-data">Step 2. Preprocess the data</a>
  <ul class="collapse">
  <li><a href="#identify-the-most-frequent-mci-category-and-the-most-frequent-offence-within-that-category" id="toc-identify-the-most-frequent-mci-category-and-the-most-frequent-offence-within-that-category" class="nav-link" data-scroll-target="#identify-the-most-frequent-mci-category-and-the-most-frequent-offence-within-that-category">2.1 Identify the most frequent MCI category and the most frequent offence within that category</a></li>
  <li><a href="#build-the-analytic-dataset-with-the-selected-category-and-offence" id="toc-build-the-analytic-dataset-with-the-selected-category-and-offence" class="nav-link" data-scroll-target="#build-the-analytic-dataset-with-the-selected-category-and-offence">2.2 Build the analytic dataset with the selected category and offence</a></li>
  <li><a href="#rename-variables-for-readability-and-preprocess-the-variables-value-mapping-type-conversion-etc." id="toc-rename-variables-for-readability-and-preprocess-the-variables-value-mapping-type-conversion-etc." class="nav-link" data-scroll-target="#rename-variables-for-readability-and-preprocess-the-variables-value-mapping-type-conversion-etc.">2.3 Rename variables for readability and preprocess the variables (value mapping, type conversion, etc.)</a></li>
  <li><a href="#identify-and-clean-impossible-data" id="toc-identify-and-clean-impossible-data" class="nav-link" data-scroll-target="#identify-and-clean-impossible-data">2.4 Identify and clean impossible data</a></li>
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1">2.5 Summary</a></li>
  </ul></li>
  <li><a href="#step-3.-check-data-completeness-across-years" id="toc-step-3.-check-data-completeness-across-years" class="nav-link" data-scroll-target="#step-3.-check-data-completeness-across-years">Step 3. Check data completeness across years</a>
  <ul class="collapse">
  <li><a href="#examine-which-years-are-present-in-the-data" id="toc-examine-which-years-are-present-in-the-data" class="nav-link" data-scroll-target="#examine-which-years-are-present-in-the-data">3.1 Examine which years are present in the data</a></li>
  <li><a href="#cross-reference-with-documentation-to-identify-valid-time-range" id="toc-cross-reference-with-documentation-to-identify-valid-time-range" class="nav-link" data-scroll-target="#cross-reference-with-documentation-to-identify-valid-time-range">3.2 Cross-reference with documentation to identify valid time range</a></li>
  <li><a href="#examine-completeness-within-valid-time-range-according-to-the-data-documentation" id="toc-examine-completeness-within-valid-time-range-according-to-the-data-documentation" class="nav-link" data-scroll-target="#examine-completeness-within-valid-time-range-according-to-the-data-documentation">3.3 Examine completeness within valid time range according to the data documentation</a></li>
  <li><a href="#subset-to-years-with-complete-data" id="toc-subset-to-years-with-complete-data" class="nav-link" data-scroll-target="#subset-to-years-with-complete-data">3.4 Subset to years with complete data</a></li>
  <li><a href="#summary-2" id="toc-summary-2" class="nav-link" data-scroll-target="#summary-2">3.5 Summary</a></li>
  </ul></li>
  <li><a href="#step-4.-examine-annual-change-in-crime" id="toc-step-4.-examine-annual-change-in-crime" class="nav-link" data-scroll-target="#step-4.-examine-annual-change-in-crime">Step 4. Examine annual change in crime</a>
  <ul class="collapse">
  <li><a href="#aggregate-data-to-annual-counts" id="toc-aggregate-data-to-annual-counts" class="nav-link" data-scroll-target="#aggregate-data-to-annual-counts">4.1 Aggregate data to annual counts</a></li>
  <li><a href="#plot-counts-over-time" id="toc-plot-counts-over-time" class="nav-link" data-scroll-target="#plot-counts-over-time">4.2 Plot counts over time</a></li>
  <li><a href="#fit-poisson-regression-to-quantify-annual-trend" id="toc-fit-poisson-regression-to-quantify-annual-trend" class="nav-link" data-scroll-target="#fit-poisson-regression-to-quantify-annual-trend">4.3 Fit Poisson regression to quantify annual trend</a></li>
  <li><a href="#model-fit-and-assumptions" id="toc-model-fit-and-assumptions" class="nav-link" data-scroll-target="#model-fit-and-assumptions">4.4 Model fit and assumptions</a></li>
  <li><a href="#summary-3" id="toc-summary-3" class="nav-link" data-scroll-target="#summary-3">4.5 Summary</a></li>
  </ul></li>
  <li><a href="#step-5.-examine-seasonality-in-crime" id="toc-step-5.-examine-seasonality-in-crime" class="nav-link" data-scroll-target="#step-5.-examine-seasonality-in-crime">Step 5. Examine seasonality in crime</a>
  <ul class="collapse">
  <li><a href="#subset-to-the-most-recent-complete-year" id="toc-subset-to-the-most-recent-complete-year" class="nav-link" data-scroll-target="#subset-to-the-most-recent-complete-year">5.1 Subset to the most recent complete year</a></li>
  <li><a href="#create-season-variable" id="toc-create-season-variable" class="nav-link" data-scroll-target="#create-season-variable">5.2 Create season variable</a></li>
  <li><a href="#summary-statistics-of-assault-crime-counts-by-season" id="toc-summary-statistics-of-assault-crime-counts-by-season" class="nav-link" data-scroll-target="#summary-statistics-of-assault-crime-counts-by-season">5.3 Summary statistics of assault crime counts by season</a></li>
  <li><a href="#plot-assault-crime-counts-by-season" id="toc-plot-assault-crime-counts-by-season" class="nav-link" data-scroll-target="#plot-assault-crime-counts-by-season">5.4 Plot assault crime counts by season</a></li>
  <li><a href="#simple-chi-square-test-for-seasonal-differences" id="toc-simple-chi-square-test-for-seasonal-differences" class="nav-link" data-scroll-target="#simple-chi-square-test-for-seasonal-differences">5.5 Simple Chi-square test for seasonal differences</a></li>
  </ul></li>
  <li><a href="#step-6.-examine-seasonality-day-vs-night" id="toc-step-6.-examine-seasonality-day-vs-night" class="nav-link" data-scroll-target="#step-6.-examine-seasonality-day-vs-night">Step 6. Examine seasonality, day vs night</a>
  <ul class="collapse">
  <li><a href="#summarize-crime-counts-by-hour" id="toc-summarize-crime-counts-by-hour" class="nav-link" data-scroll-target="#summarize-crime-counts-by-hour">6.1 Summarize crime counts by hour</a></li>
  <li><a href="#create-daynight-indicator" id="toc-create-daynight-indicator" class="nav-link" data-scroll-target="#create-daynight-indicator">6.2 Create day/night indicator</a></li>
  <li><a href="#create-season-daynight-contingency-table" id="toc-create-season-daynight-contingency-table" class="nav-link" data-scroll-target="#create-season-daynight-contingency-table">6.3 Create season × day/night contingency table</a></li>
  <li><a href="#visualize-the-contingency-table" id="toc-visualize-the-contingency-table" class="nav-link" data-scroll-target="#visualize-the-contingency-table">6.4 Visualize the contingency table</a></li>
  <li><a href="#chi-square-test-for-independence" id="toc-chi-square-test-for-independence" class="nav-link" data-scroll-target="#chi-square-test-for-independence">6.5 Chi-square test for independence</a></li>
  </ul></li>
  <li><a href="#step-7.-look-at-neighbourhood-patterns" id="toc-step-7.-look-at-neighbourhood-patterns" class="nav-link" data-scroll-target="#step-7.-look-at-neighbourhood-patterns">Step 7. Look at neighbourhood patterns</a></li>
  <li><a href="#step-8.-create-a-map" id="toc-step-8.-create-a-map" class="nav-link" data-scroll-target="#step-8.-create-a-map">Step 8. Create a map</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 1 — EDA and Visualization</h1>
<p class="subtitle lead">JSC370 (Winter 2026)</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 1, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="primary-question" class="level1">
<h1>Primary Question</h1>
<p>What are the most numerous categories of crimes and offences in Toronto? Of these, when and where are they most likely to occur?</p>
</section>
<section id="environment-setup" class="level1">
<h1>Environment Setup</h1>
<div id="environment-setup" class="cell" data-message="false" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chisquare, chi2_contingency</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-1.-read-in-the-data" class="level1">
<h1>Step 1. Read in the data</h1>
<section id="read-the-data-with-only-the-needed-columns" class="level2">
<h2 class="anchored" data-anchor-id="read-the-data-with-only-the-needed-columns">1.1 Read the data with only the needed columns</h2>
<div id="cell-read-data" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read and load only the needed columns</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data_path <span class="op">=</span> <span class="st">"Major_Crime_Indicators_Open_Data_-3805566126367379926.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on the following variables:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>key_vars <span class="op">=</span> [</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MCI_CATEGORY"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OFFENCE"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OCC_YEAR"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OCC_MONTH"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OCC_DAY"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OCC_DOY"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OCC_HOUR"</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LOCATION_TYPE"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NEIGHBOURHOOD_158"</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LONG_WGS84"</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LAT_WGS84"</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>raw <span class="op">=</span> pd.read_csv(data_path, usecols<span class="op">=</span>key_vars)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick look at the data</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> raw.copy()</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="read-data" class="cell-output cell-output-display" data-execution_count="137">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OCC_YEAR</th>
<th data-quarto-table-cell-role="th">OCC_MONTH</th>
<th data-quarto-table-cell-role="th">OCC_DAY</th>
<th data-quarto-table-cell-role="th">OCC_DOY</th>
<th data-quarto-table-cell-role="th">OCC_HOUR</th>
<th data-quarto-table-cell-role="th">LOCATION_TYPE</th>
<th data-quarto-table-cell-role="th">OFFENCE</th>
<th data-quarto-table-cell-role="th">MCI_CATEGORY</th>
<th data-quarto-table-cell-role="th">NEIGHBOURHOOD_158</th>
<th data-quarto-table-cell-role="th">LONG_WGS84</th>
<th data-quarto-table-cell-role="th">LAT_WGS84</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>2014.0</td>
<td>January</td>
<td>1.0</td>
<td>1.0</td>
<td>4</td>
<td>Apartment (Rooming House, Condo)</td>
<td>Assault</td>
<td>Assault</td>
<td>Downsview (155)</td>
<td>-79.483869</td>
<td>43.734369</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2014.0</td>
<td>January</td>
<td>1.0</td>
<td>1.0</td>
<td>8</td>
<td>Commercial Dwelling Unit (Hotel, Motel, B &amp; B,...</td>
<td>Assault With Weapon</td>
<td>Assault</td>
<td>Oakdale-Beverley Heights (154)</td>
<td>-79.513772</td>
<td>43.719813</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>2014.0</td>
<td>January</td>
<td>1.0</td>
<td>1.0</td>
<td>12</td>
<td>Single Home, House (Attach Garage, Cottage, Mo...</td>
<td>Assault Bodily Harm</td>
<td>Assault</td>
<td>North Riverdale (68)</td>
<td>-79.357562</td>
<td>43.674791</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2014.0</td>
<td>January</td>
<td>1.0</td>
<td>1.0</td>
<td>13</td>
<td>Retirement Home</td>
<td>Assault</td>
<td>Assault</td>
<td>Wychwood (94)</td>
<td>-79.422371</td>
<td>43.673842</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>2014.0</td>
<td>January</td>
<td>1.0</td>
<td>1.0</td>
<td>11</td>
<td>Apartment (Rooming House, Condo)</td>
<td>Assault</td>
<td>Assault</td>
<td>Clairlea-Birchmount (120)</td>
<td>-79.286725</td>
<td>43.700100</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="check-the-data-dimensions-and-memory" class="level2">
<h2 class="anchored" data-anchor-id="check-the-data-dimensions-and-memory">1.2 Check the data dimensions and memory</h2>
<div id="cell-check-data" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check dimensions and memory</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"shape:"</span>, df.shape)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"n_rows:"</span>, df.shape[<span class="dv">0</span>])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"n_cols:"</span>, df.shape[<span class="dv">1</span>])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check memory usage in GB</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>df.memory_usage(deep<span class="op">=</span><span class="va">True</span>).<span class="bu">sum</span>() <span class="op">/</span> <span class="dv">1024</span><span class="op">**</span><span class="dv">3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (452949, 11)
n_rows: 452949
n_cols: 11</code></pre>
</div>
<div id="check-data" class="cell-output cell-output-display" data-execution_count="138">
<pre><code>np.float64(0.16353116929531097)</code></pre>
</div>
</div>
</section>
<section id="check-the-data-types" class="level2">
<h2 class="anchored" data-anchor-id="check-the-data-types">1.3 Check the data types</h2>
<div id="check-data-types" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check variable information</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df.info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 452949 entries, 0 to 452948
Data columns (total 11 columns):
 #   Column             Non-Null Count   Dtype  
---  ------             --------------   -----  
 0   OCC_YEAR           452798 non-null  float64
 1   OCC_MONTH          452798 non-null  object 
 2   OCC_DAY            452798 non-null  float64
 3   OCC_DOY            452798 non-null  float64
 4   OCC_HOUR           452949 non-null  int64  
 5   LOCATION_TYPE      452949 non-null  object 
 6   OFFENCE            452949 non-null  object 
 7   MCI_CATEGORY       452949 non-null  object 
 8   NEIGHBOURHOOD_158  452949 non-null  object 
 9   LONG_WGS84         452949 non-null  float64
 10  LAT_WGS84          452949 non-null  float64
dtypes: float64(5), int64(1), object(5)
memory usage: 38.0+ MB</code></pre>
</div>
</div>
</section>
<section id="check-the-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="check-the-missing-values">1.4 Check the missing values</h2>
<div id="cell-check-missing-values" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize missing-value placeholders across all columns</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>missing_markers <span class="op">=</span> [<span class="st">""</span>, <span class="st">" "</span>, <span class="st">"N/A"</span>, <span class="st">"NA"</span>, <span class="st">"null"</span>, <span class="st">"Null"</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.replace(missing_markers, np.nan)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Missing data summary</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>missing <span class="op">=</span> df.isna().<span class="bu">sum</span>().to_frame(<span class="st">"n_missing"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>missing[<span class="st">"pct_missing"</span>] <span class="op">=</span> (missing[<span class="st">"n_missing"</span>] <span class="op">/</span> <span class="bu">len</span>(df)).<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>display(missing.sort_values(<span class="st">"pct_missing"</span>, ascending<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="check-missing-values" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_missing</th>
<th data-quarto-table-cell-role="th">pct_missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">OCC_YEAR</th>
<td>151</td>
<td>0.0003</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">OCC_MONTH</th>
<td>151</td>
<td>0.0003</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">OCC_DAY</th>
<td>151</td>
<td>0.0003</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">OCC_DOY</th>
<td>151</td>
<td>0.0003</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">OCC_HOUR</th>
<td>0</td>
<td>0.0000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">LOCATION_TYPE</th>
<td>0</td>
<td>0.0000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">OFFENCE</th>
<td>0</td>
<td>0.0000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">MCI_CATEGORY</th>
<td>0</td>
<td>0.0000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">NEIGHBOURHOOD_158</th>
<td>0</td>
<td>0.0000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">LONG_WGS84</th>
<td>0</td>
<td>0.0000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">LAT_WGS84</th>
<td>0</td>
<td>0.0000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">1.5 Summary</h2>
<p>Summary:</p>
<ul>
<li>Read the Toronto Police major crime indicators dataset from the downloaded CSV file using <code>pd.read_csv(..., usecols=key_vars)</code> to load only the 11 variables required for this homework: <code>MCI_CATEGORY</code>, <code>OFFENCE</code>, <code>OCC_YEAR</code>, <code>OCC_MONTH</code>, <code>OCC_DAY</code>, <code>OCC_DOY</code>, <code>OCC_HOUR</code>, <code>LOCATION_TYPE</code>, <code>NEIGHBOURHOOD_158</code>, <code>LONG_WGS84</code>, <code>LAT_WGS84</code>. Then make a copy of the dataframe for further analysis/preprocessing.</li>
<li>The resulting dataframe has <strong>452,949 rows</strong> and <strong>11 columns</strong>.</li>
<li>Variable types (from <code>df.info()</code>): <strong><code>int64</code></strong>: <code>OCC_HOUR</code>. <strong><code>float64</code></strong>: <code>OCC_YEAR</code>, <code>OCC_DAY</code>, <code>OCC_DOY</code>, <code>LONG_WGS84</code>, <code>LAT_WGS84</code> (the date fields are <code>float64</code>). <strong><code>object</code></strong>: <code>OCC_MONTH</code>, <code>LOCATION_TYPE</code>, <code>OFFENCE</code>, <code>MCI_CATEGORY</code>, <code>NEIGHBOURHOOD_158</code>.</li>
<li>Checked the number of missing values for each variable after converting common missing-value identifiers (<code>""</code>, <code>" "</code>, <code>"N/A"</code>, <code>"NA"</code>, <code>"null"</code>, <code>"Null"</code>) to <code>NaN</code>. The only missing values among these 11 variables are <strong>151</strong> rows with missing values in <code>OCC_YEAR</code>, <code>OCC_MONTH</code>, <code>OCC_DAY</code>, and <code>OCC_DOY</code> (each has 151 missing); the other variables have no missing values.</li>
</ul>
</section>
</section>
<section id="step-2.-preprocess-the-data" class="level1">
<h1>Step 2. Preprocess the data</h1>
<section id="identify-the-most-frequent-mci-category-and-the-most-frequent-offence-within-that-category" class="level2">
<h2 class="anchored" data-anchor-id="identify-the-most-frequent-mci-category-and-the-most-frequent-offence-within-that-category">2.1 Identify the most frequent MCI category and the most frequent offence within that category</h2>
<div id="select-category-offence" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the most frequent MCI category</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>cat_counts <span class="op">=</span> df[<span class="st">"MCI_CATEGORY"</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>display(cat_counts.head(<span class="dv">10</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>top_category <span class="op">=</span> cat_counts.index[<span class="dv">0</span>]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Most frequent MCI_CATEGORY:"</span>, top_category)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Within that category, identify the most frequent offence</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>off_counts <span class="op">=</span> (</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    df.loc[df[<span class="st">"MCI_CATEGORY"</span>] <span class="op">==</span> top_category, <span class="st">"OFFENCE"</span>]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      .value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>display(off_counts.head(<span class="dv">10</span>))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>top_offence <span class="op">=</span> off_counts.index[<span class="dv">0</span>]</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Most frequent OFFENCE within category:"</span>, top_offence)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="select-category-offence-1" class="cell-output cell-output-display">
<pre><code>MCI_CATEGORY
Assault            242671
Break and Enter     81551
Auto Theft          73739
Robbery             39117
Theft Over          15871
Name: count, dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Most frequent MCI_CATEGORY: Assault</code></pre>
</div>
<div id="select-category-offence-2" class="cell-output cell-output-display">
<pre><code>OFFENCE
Assault                           166524
Assault With Weapon                41658
Assault Bodily Harm                10456
Assault Peace Officer               7859
Assault - Resist/ Prevent Seiz      3804
Aggravated Assault                  3217
Discharge Firearm With Intent       2735
Discharge Firearm - Recklessly      1941
Pointing A Firearm                  1643
Assault Peace Officer Wpn/Cbh        880
Name: count, dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Most frequent OFFENCE within category: Assault</code></pre>
</div>
</div>
</section>
<section id="build-the-analytic-dataset-with-the-selected-category-and-offence" class="level2">
<h2 class="anchored" data-anchor-id="build-the-analytic-dataset-with-the-selected-category-and-offence">2.2 Build the analytic dataset with the selected category and offence</h2>
<div id="build-analytic-dataset" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create analytic dataset for the selected category/offence</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>crime <span class="op">=</span> df.loc[</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    (df[<span class="st">"MCI_CATEGORY"</span>] <span class="op">==</span> top_category) <span class="op">&amp;</span> (df[<span class="st">"OFFENCE"</span>] <span class="op">==</span> top_offence),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    key_vars,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Analytic dataset shape:"</span>, crime.shape)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analytic dataset shape: (166524, 11)</code></pre>
</div>
</div>
</section>
<section id="rename-variables-for-readability-and-preprocess-the-variables-value-mapping-type-conversion-etc." class="level2">
<h2 class="anchored" data-anchor-id="rename-variables-for-readability-and-preprocess-the-variables-value-mapping-type-conversion-etc.">2.3 Rename variables for readability and preprocess the variables (value mapping, type conversion, etc.)</h2>
<div id="cell-rename-and-convert-types" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename key variables for readability</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>crime <span class="op">=</span> crime.rename(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"MCI_CATEGORY"</span>: <span class="st">"category"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"OFFENCE"</span>: <span class="st">"offence"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"OCC_YEAR"</span>: <span class="st">"occurrence_year"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"OCC_MONTH"</span>: <span class="st">"occurrence_month"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"OCC_DAY"</span>: <span class="st">"occurrence_day"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"OCC_DOY"</span>: <span class="st">"day_of_year"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"OCC_HOUR"</span>: <span class="st">"hour"</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LOCATION_TYPE"</span>: <span class="st">"location_type"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NEIGHBOURHOOD_158"</span>: <span class="st">"neighbourhood"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LONG_WGS84"</span>: <span class="st">"lon"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LAT_WGS84"</span>: <span class="st">"lat"</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert time variables to numeric</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>crime[<span class="st">"occurrence_year"</span>] <span class="op">=</span> pd.to_numeric(crime[<span class="st">"occurrence_year"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>).astype(<span class="st">"Int64"</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>crime[<span class="st">"occurrence_day"</span>] <span class="op">=</span> pd.to_numeric(crime[<span class="st">"occurrence_day"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>).astype(<span class="st">"Int64"</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>crime[<span class="st">"day_of_year"</span>] <span class="op">=</span> pd.to_numeric(crime[<span class="st">"day_of_year"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>).astype(<span class="st">"Int64"</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># OCC_MONTH is stored as month names; map to month numbers</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>month_map <span class="op">=</span> {</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"January"</span>: <span class="dv">1</span>, <span class="st">"February"</span>: <span class="dv">2</span>, <span class="st">"March"</span>: <span class="dv">3</span>, <span class="st">"April"</span>: <span class="dv">4</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"May"</span>: <span class="dv">5</span>, <span class="st">"June"</span>: <span class="dv">6</span>, <span class="st">"July"</span>: <span class="dv">7</span>, <span class="st">"August"</span>: <span class="dv">8</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"September"</span>: <span class="dv">9</span>, <span class="st">"October"</span>: <span class="dv">10</span>, <span class="st">"November"</span>: <span class="dv">11</span>, <span class="st">"December"</span>: <span class="dv">12</span>,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>crime[<span class="st">"occurrence_month"</span>] <span class="op">=</span> (</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    pd.to_numeric(crime[<span class="st">"occurrence_month"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    .fillna(crime[<span class="st">"occurrence_month"</span>].<span class="bu">map</span>(month_map))</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    .astype(<span class="st">"Int64"</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert strings to categorical</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"category"</span>, <span class="st">"offence"</span>, <span class="st">"location_type"</span>, <span class="st">"neighbourhood"</span>]:</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    crime[col] <span class="op">=</span> crime[col].astype(<span class="st">"category"</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>crime.info()</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>display(crime.head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 166524 entries, 0 to 452948
Data columns (total 11 columns):
 #   Column            Non-Null Count   Dtype   
---  ------            --------------   -----   
 0   category          166524 non-null  category
 1   offence           166524 non-null  category
 2   occurrence_year   166440 non-null  Int64   
 3   occurrence_month  166440 non-null  Int64   
 4   occurrence_day    166440 non-null  Int64   
 5   day_of_year       166440 non-null  Int64   
 6   hour              166524 non-null  int64   
 7   location_type     166524 non-null  category
 8   neighbourhood     166524 non-null  category
 9   lon               166524 non-null  float64 
 10  lat               166524 non-null  float64 
dtypes: Int64(4), category(4), float64(2), int64(1)
memory usage: 11.6 MB</code></pre>
</div>
<div id="rename-and-convert-types" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">offence</th>
<th data-quarto-table-cell-role="th">occurrence_year</th>
<th data-quarto-table-cell-role="th">occurrence_month</th>
<th data-quarto-table-cell-role="th">occurrence_day</th>
<th data-quarto-table-cell-role="th">day_of_year</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">location_type</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">lat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Assault</td>
<td>Assault</td>
<td>2014</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>Apartment (Rooming House, Condo)</td>
<td>Downsview (155)</td>
<td>-79.483869</td>
<td>43.734369</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Assault</td>
<td>Assault</td>
<td>2014</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>13</td>
<td>Retirement Home</td>
<td>Wychwood (94)</td>
<td>-79.422371</td>
<td>43.673842</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Assault</td>
<td>Assault</td>
<td>2014</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>11</td>
<td>Apartment (Rooming House, Condo)</td>
<td>Clairlea-Birchmount (120)</td>
<td>-79.286725</td>
<td>43.700100</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">8</th>
<td>Assault</td>
<td>Assault</td>
<td>2014</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>20</td>
<td>Single Home, House (Attach Garage, Cottage, Mo...</td>
<td>Yonge-Eglinton (100)</td>
<td>-79.400083</td>
<td>43.705466</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">9</th>
<td>Assault</td>
<td>Assault</td>
<td>2014</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>20</td>
<td>Single Home, House (Attach Garage, Cottage, Mo...</td>
<td>Yonge-Eglinton (100)</td>
<td>-79.400083</td>
<td>43.705466</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="identify-and-clean-impossible-data" class="level2">
<h2 class="anchored" data-anchor-id="identify-and-clean-impossible-data">2.4 Identify and clean impossible data</h2>
<div id="identify-and-clean-impossible-data" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean impossible data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Coordinates (0,0) indicate NSA/outside Toronto</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for (0,0) coordinates</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>zero_coords <span class="op">=</span> (crime[<span class="st">"lon"</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (crime[<span class="st">"lat"</span>] <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Sample of (0,0) coordinate records:"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>display(crime.loc[zero_coords, [<span class="st">"neighbourhood"</span>, <span class="st">"lon"</span>, <span class="st">"lat"</span>]].head(<span class="dv">10</span>))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set (0,0) coordinates to NaN</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>crime.loc[zero_coords, [<span class="st">"lon"</span>, <span class="st">"lat"</span>]] <span class="op">=</span> np.nan</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Missing data summary after coordinate cleaning</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>missing <span class="op">=</span> crime.isna().<span class="bu">sum</span>().to_frame(<span class="st">"n_missing"</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>missing[<span class="st">"pct_missing"</span>] <span class="op">=</span> (missing[<span class="st">"n_missing"</span>] <span class="op">/</span> <span class="bu">len</span>(crime)).<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>display(missing.sort_values(<span class="st">"pct_missing"</span>, ascending<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Sample of (0,0) coordinate records:</code></pre>
</div>
<div id="identify-and-clean-impossible-data-1" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">lat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">81</th>
<td>NSA</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">294</th>
<td>NSA</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">333</th>
<td>NSA</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">347</th>
<td>NSA</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">403</th>
<td>NSA</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">571</th>
<td>NSA</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">780</th>
<td>NSA</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">781</th>
<td>NSA</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">828</th>
<td>NSA</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">879</th>
<td>NSA</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="identify-and-clean-impossible-data-2" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_missing</th>
<th data-quarto-table-cell-role="th">pct_missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">lon</th>
<td>2864</td>
<td>0.0172</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">lat</th>
<td>2864</td>
<td>0.0172</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">occurrence_year</th>
<td>84</td>
<td>0.0005</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">occurrence_month</th>
<td>84</td>
<td>0.0005</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">occurrence_day</th>
<td>84</td>
<td>0.0005</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">day_of_year</th>
<td>84</td>
<td>0.0005</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">category</th>
<td>0</td>
<td>0.0000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">offence</th>
<td>0</td>
<td>0.0000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">hour</th>
<td>0</td>
<td>0.0000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">location_type</th>
<td>0</td>
<td>0.0000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">neighbourhood</th>
<td>0</td>
<td>0.0000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="summary-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-1">2.5 Summary</h2>
<ul>
<li>I used frequency counts (<code>value_counts</code>) on <code>MCI_CATEGORY</code> to pick the most common category in the full dataset, then (within that category) used frequency counts on <code>OFFENCE</code> to pick the most common offence. Using this rule, the selected category is <strong>Assault</strong> and the selected offence is <strong>Assault</strong>.</li>
<li>I filtered the data to only the selected category/offence and kept only the “necessary columns” from Question 1 (<code>key_vars</code>). This produced the analytic dataset <code>crime</code> with <strong>166,524 rows</strong> and <strong>11 columns</strong>.</li>
<li>I renamed columns to make them easier to interpret and use later. This keeps the same information but with clearer names for analysis and plotting.</li>
<li>I converted time and date fields to nullable integers (<code>Int64</code>), mapping month names to numbers (1–12). I also converted <code>category</code>, <code>offence</code>, <code>location_type</code>, and <code>neighbourhood</code> to pandas <code>category</code> type to reflect that they are nominal labels.</li>
<li>I identified records with coordinates <strong>(lon, lat) = (0, 0)</strong> and treated these as invalid geographic coordinates (documentation indicates “not specified area/outside Toronto”, our primary question is focused on Toronto only), so I set <code>lon</code> and <code>lat</code> to <code>NaN</code> for those rows. After cleaning, <code>lon</code> and <code>lat</code> each have <strong>2,864</strong> missing values ((0.0172 %) of <code>crime</code>).</li>
</ul>
</section>
</section>
<section id="step-3.-check-data-completeness-across-years" class="level1">
<h1>Step 3. Check data completeness across years</h1>
<section id="examine-which-years-are-present-in-the-data" class="level2">
<h2 class="anchored" data-anchor-id="examine-which-years-are-present-in-the-data">3.1 Examine which years are present in the data</h2>
<div id="cell-examine-years-present" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check which years are present in the crime dataset</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>year_counts <span class="op">=</span> crime[<span class="st">"occurrence_year"</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>).sort_index()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Years present in crime dataset:"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>display(year_counts)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing years</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Year range: </span><span class="sc">{</span>crime[<span class="st">'occurrence_year'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>crime[<span class="st">'occurrence_year'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Missing values in occurrence_year: </span><span class="sc">{</span>crime[<span class="st">'occurrence_year'</span>]<span class="sc">.</span>isna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Years present in crime dataset:</code></pre>
</div>
<div id="examine-years-present" class="cell-output cell-output-display">
<pre><code>occurrence_year
2000       20
2001       16
2002       15
2003       19
2004       28
2005       27
2006       16
2007       25
2008       36
2009       56
2010       74
2011       90
2012      144
2013      314
2014    11889
2015    12387
2016    12972
2017    13397
2018    13744
2019    14327
2020    12549
2021    13125
2022    14694
2023    16878
2024    17204
2025    12394
&lt;NA&gt;       84
Name: count, dtype: Int64</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Year range: 2000 to 2025
Missing values in occurrence_year: 84</code></pre>
</div>
</div>
</section>
<section id="cross-reference-with-documentation-to-identify-valid-time-range" class="level2">
<h2 class="anchored" data-anchor-id="cross-reference-with-documentation-to-identify-valid-time-range">3.2 Cross-reference with documentation to identify valid time range</h2>
<div id="cross-reference-documentation" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Documentation (Appendix A): MCI Assault data covers 2014 – 2025.09.30 (quarterly updates)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>valid_start_year <span class="op">=</span> <span class="dv">2014</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>valid_end_year <span class="op">=</span> <span class="dv">2025</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>assault_valid <span class="op">=</span> crime[</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    crime[<span class="st">"occurrence_year"</span>].between(valid_start_year, valid_end_year, inclusive<span class="op">=</span><span class="st">"both"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Documentation: MCI Assault data covers </span><span class="sc">{</span>valid_start_year<span class="sc">}</span><span class="ss"> – </span><span class="sc">{</span>valid_end_year<span class="sc">}</span><span class="ss">.09.30"</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Original dataset: </span><span class="sc">{</span><span class="bu">len</span>(crime)<span class="sc">:,}</span><span class="ss"> rows"</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">After filtering to valid range (</span><span class="sc">{</span>valid_start_year<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>valid_end_year<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span><span class="bu">len</span>(assault_valid)<span class="sc">:,}</span><span class="ss"> rows"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Documentation: MCI Assault data covers 2014 – 2025.09.30

Original dataset: 166,524 rows

After filtering to valid range (2014-2025): 165,560 rows</code></pre>
</div>
</div>
</section>
<section id="examine-completeness-within-valid-time-range-according-to-the-data-documentation" class="level2">
<h2 class="anchored" data-anchor-id="examine-completeness-within-valid-time-range-according-to-the-data-documentation">3.3 Examine completeness within valid time range according to the data documentation</h2>
<div id="cell-examine-completeness-valid-range" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check completeness: months present and date range for each year</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>year_completeness <span class="op">=</span> assault_valid.groupby(<span class="st">"occurrence_year"</span>).agg(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    n_records<span class="op">=</span>(<span class="st">"occurrence_year"</span>, <span class="st">"count"</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    n_months<span class="op">=</span>(<span class="st">"occurrence_month"</span>, <span class="st">"nunique"</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    min_month<span class="op">=</span>(<span class="st">"occurrence_month"</span>, <span class="st">"min"</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    max_month<span class="op">=</span>(<span class="st">"occurrence_month"</span>, <span class="st">"max"</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    min_doy<span class="op">=</span>(<span class="st">"day_of_year"</span>, <span class="st">"min"</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    max_doy<span class="op">=</span>(<span class="st">"day_of_year"</span>, <span class="st">"max"</span>),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add completeness indicator</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>year_completeness[<span class="st">"complete"</span>] <span class="op">=</span> year_completeness[<span class="st">"n_months"</span>] <span class="op">==</span> <span class="dv">12</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Year completeness summary:"</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>display(year_completeness)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Year completeness summary:</code></pre>
</div>
<div id="examine-completeness-valid-range" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">occurrence_year</th>
<th data-quarto-table-cell-role="th">n_records</th>
<th data-quarto-table-cell-role="th">n_months</th>
<th data-quarto-table-cell-role="th">min_month</th>
<th data-quarto-table-cell-role="th">max_month</th>
<th data-quarto-table-cell-role="th">min_doy</th>
<th data-quarto-table-cell-role="th">max_doy</th>
<th data-quarto-table-cell-role="th">complete</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>2014</td>
<td>11889</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>365</td>
<td>True</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2015</td>
<td>12387</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>365</td>
<td>True</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>2016</td>
<td>12972</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>366</td>
<td>True</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2017</td>
<td>13397</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>365</td>
<td>True</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>2018</td>
<td>13744</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>365</td>
<td>True</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>2019</td>
<td>14327</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>365</td>
<td>True</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>2020</td>
<td>12549</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>366</td>
<td>True</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>2021</td>
<td>13125</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>365</td>
<td>True</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>2022</td>
<td>14694</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>365</td>
<td>True</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>2023</td>
<td>16878</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>365</td>
<td>True</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>2024</td>
<td>17204</td>
<td>12</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>366</td>
<td>True</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>2025</td>
<td>12394</td>
<td>9</td>
<td>1</td>
<td>9</td>
<td>1</td>
<td>273</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="subset-to-years-with-complete-data" class="level2">
<h2 class="anchored" data-anchor-id="subset-to-years-with-complete-data">3.4 Subset to years with complete data</h2>
<div id="subset-complete-years" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on examination above, identify complete years (those with all 12 months)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>complete_years <span class="op">=</span> year_completeness[year_completeness[<span class="st">"complete"</span>]][<span class="st">"occurrence_year"</span>].values</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Complete years (all 12 months present): </span><span class="sc">{</span>complete_years<span class="sc">.</span>tolist()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset to complete years only</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>assault_complete <span class="op">=</span> assault_valid[assault_valid[<span class="st">"occurrence_year"</span>].isin(complete_years)].copy()</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Valid range dataset: </span><span class="sc">{</span><span class="bu">len</span>(assault_valid)<span class="sc">:,}</span><span class="ss"> rows"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"After subsetting to complete years: </span><span class="sc">{</span><span class="bu">len</span>(assault_complete)<span class="sc">:,}</span><span class="ss"> rows"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete years (all 12 months present): [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024]

Valid range dataset: 165,560 rows
After subsetting to complete years: 153,166 rows</code></pre>
</div>
</div>
</section>
<section id="summary-2" class="level2">
<h2 class="anchored" data-anchor-id="summary-2">3.5 Summary</h2>
<ul>
<li>I examined the years present in the data and found that the data covers from minimum year 2000 to maximum year 2025 and there are no missing years in this range.</li>
<li>I cross-referenced the data with the data documentation and found that the valid time range for <strong>Assault</strong> crimes data is from 2014 to 2025.09.30.</li>
<li>I examined the completeness within the valid time range according to the data documentation and found that the data is complete for the years 2014 to 2024 since good coverage of the months and days of the year is present for each year in this range. 2025 is incomplete since only through September 30th is present.</li>
<li>Therefore, I subsetted the dataset to the data lies within the range of 2014 to 2024 only.</li>
</ul>
</section>
</section>
<section id="step-4.-examine-annual-change-in-crime" class="level1">
<h1>Step 4. Examine annual change in crime</h1>
<section id="aggregate-data-to-annual-counts" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-data-to-annual-counts">4.1 Aggregate data to annual counts</h2>
<div id="cell-assault-crime-annual-counts" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate to count of crimes per year</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>annual_counts <span class="op">=</span> (</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    assault_complete.groupby(<span class="st">"occurrence_year"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"count"</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Annual crime counts:"</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>display(annual_counts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Annual crime counts:</code></pre>
</div>
<div id="assault-crime-annual-counts" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">occurrence_year</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>2014</td>
<td>11889</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2015</td>
<td>12387</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>2016</td>
<td>12972</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2017</td>
<td>13397</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>2018</td>
<td>13744</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>2019</td>
<td>14327</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>2020</td>
<td>12549</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>2021</td>
<td>13125</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>2022</td>
<td>14694</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>2023</td>
<td>16878</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>2024</td>
<td>17204</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="plot-counts-over-time" class="level2">
<h2 class="anchored" data-anchor-id="plot-counts-over-time">4.2 Plot counts over time</h2>
<div id="cell-plot-assault-crime-annual-trend" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot annual counts over time</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>ax.plot(annual_counts[<span class="st">"occurrence_year"</span>], annual_counts[<span class="st">"count"</span>], </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'o'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Year"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Number of Assault Crimes"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Annual Assault Crime Counts in Toronto (2014-2024)"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(annual_counts[<span class="st">"occurrence_year"</span>])</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_files/figure-html/plot-assault-crime-annual-trend-output-1.png" id="plot-assault-crime-annual-trend" width="951" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fit-poisson-regression-to-quantify-annual-trend" class="level2">
<h2 class="anchored" data-anchor-id="fit-poisson-regression-to-quantify-annual-trend">4.3 Fit Poisson regression to quantify annual trend</h2>
<div id="poisson-regression" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Poisson regression: count ~ year (as numeric)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># y = annual crime count, x = year (numeric)</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>poisson_model <span class="op">=</span> smf.glm(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    formula<span class="op">=</span><span class="st">"count ~ occurrence_year"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>annual_counts,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span>sm.families.Poisson()</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Poisson Regression Results:"</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poisson_model.summary())</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficient for year</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>year_coef <span class="op">=</span> poisson_model.params[<span class="st">"occurrence_year"</span>]</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>year_se <span class="op">=</span> poisson_model.bse[<span class="st">"occurrence_year"</span>]</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>year_pvalue <span class="op">=</span> poisson_model.pvalues[<span class="st">"occurrence_year"</span>]</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate rate ratio per 1-year increase</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>rate_ratio <span class="op">=</span> np.exp(year_coef)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>rate_ratio_ci <span class="op">=</span> np.exp([</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    year_coef <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> year_se,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    year_coef <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> year_se</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Annual Trend Estimate ---"</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Coefficient (log rate ratio per year): </span><span class="sc">{</span>year_coef<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Rate ratio per 1-year increase: </span><span class="sc">{</span>rate_ratio<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"95% CI for rate ratio: (</span><span class="sc">{</span>rate_ratio_ci[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>rate_ratio_ci[<span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percent change for interpretation</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>pct_change <span class="op">=</span> (rate_ratio <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Percent change per year: </span><span class="sc">{</span>pct_change<span class="sc">:+.2f}</span><span class="ss">%"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Poisson Regression Results:
                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:                  count   No. Observations:                   11
Model:                            GLM   Df Residuals:                        9
Model Family:                 Poisson   Df Model:                            1
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -372.70
Date:                Sun, 01 Feb 2026   Deviance:                       620.30
Time:                        12:32:26   Pearson chi2:                     608.
No. Iterations:                     4   Pseudo R-squ. (CS):              1.000
Covariance Type:            nonrobust                                         
===================================================================================
                      coef    std err          z      P&gt;|z|      [0.025      0.975]
-----------------------------------------------------------------------------------
Intercept         -53.8177      1.637    -32.885      0.000     -57.025     -50.610
occurrence_year     0.0314      0.001     38.718      0.000       0.030       0.033
===================================================================================

--- Annual Trend Estimate ---
Coefficient (log rate ratio per year): 0.031379
Rate ratio per 1-year increase: 1.0319
95% CI for rate ratio: (1.0302, 1.0335)
Percent change per year: +3.19%</code></pre>
</div>
</div>
<p><strong>Interpretation:</strong> For each 1-year increase from 2014 to 2024, the expected annual assault crime count increases by approximately 3.19%, suggesting a statistically significant upward trend in assault crimes over this period.</p>
</section>
<section id="model-fit-and-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="model-fit-and-assumptions">4.4 Model fit and assumptions</h2>
<div id="cell-poisson-model-fit-and-assumptions" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check model fit: compare observed vs fitted values</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>annual_counts[<span class="st">"fitted"</span>] <span class="op">=</span> poisson_model.fittedvalues</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>annual_counts[<span class="st">"residuals"</span>] <span class="op">=</span> poisson_model.resid_deviance</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot observed vs fitted</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed vs Fitted</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].scatter(annual_counts[<span class="st">"occurrence_year"</span>], annual_counts[<span class="st">"count"</span>], </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">"Observed"</span>, s<span class="op">=</span><span class="dv">80</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(annual_counts[<span class="st">"occurrence_year"</span>], annual_counts[<span class="st">"fitted"</span>], </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">"Fitted"</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Year"</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Count"</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Observed vs Fitted Values"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual plot</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(annual_counts[<span class="st">"occurrence_year"</span>], annual_counts[<span class="st">"residuals"</span>], </span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>                s<span class="op">=</span><span class="dv">80</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Year"</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Deviance Residuals"</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Residual Plot"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Goodness of fit: deviance and Pearson chi-squared</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Model Fit Statistics ---"</span>)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Deviance: </span><span class="sc">{</span>poisson_model<span class="sc">.</span>deviance<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pearson chi-squared: </span><span class="sc">{</span>poisson_model<span class="sc">.</span>pearson_chi2<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Degrees of freedom: </span><span class="sc">{</span>poisson_model<span class="sc">.</span>df_resid<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for overdispersion</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>dispersion <span class="op">=</span> poisson_model.pearson_chi2 <span class="op">/</span> poisson_model.df_resid</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Dispersion parameter (Pearson χ²/df): </span><span class="sc">{</span>dispersion<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_files/figure-html/poisson-model-fit-and-assumptions-output-1.png" id="poisson-model-fit-and-assumptions" width="1333" height="469" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Model Fit Statistics ---
Deviance: 620.30
Pearson chi-squared: 607.53
Degrees of freedom: 9

Dispersion parameter (Pearson χ²/df): 67.5038</code></pre>
</div>
</div>
<p><strong>Comments on Model Fit and Assumptions:</strong></p>
<p>The Poisson model captures the overall upward trend, though the residual plot shows systematic deviations (notably around 2021). The dispersion parameter (≈67.5) indicates <strong>overdispersion</strong> as it is significantly greater than the threshold 1.5, violating the Poisson assumption (variance = mean) and making standard errors unreliable.</p>
</section>
<section id="summary-3" class="level2">
<h2 class="anchored" data-anchor-id="summary-3">4.5 Summary</h2>
<p>Yes, there is statistically significant evidence of an upward trend in assault crimes across Toronto from 2014 to 2024, with the Poisson regression estimating approximately a <strong>3.19% annual increase</strong> in expected crime counts (rate ratio ≈ 1.03). However, the model exhibits severe overdispersion, suggesting that while the overall increasing trend is present, the simple Poisson model may underestimate the uncertainty in this estimate， which means the model results may not be reliable.</p>
</section>
</section>
<section id="step-5.-examine-seasonality-in-crime" class="level1">
<h1>Step 5. Examine seasonality in crime</h1>
<section id="subset-to-the-most-recent-complete-year" class="level2">
<h2 class="anchored" data-anchor-id="subset-to-the-most-recent-complete-year">5.1 Subset to the most recent complete year</h2>
<div id="subset-to-most-recent-complete-year" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>most_recent_year <span class="op">=</span> assault_complete[<span class="st">"occurrence_year"</span>].<span class="bu">max</span>()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Most recent complete year: </span><span class="sc">{</span>most_recent_year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset to that year</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>assault_recent <span class="op">=</span> assault_complete[assault_complete[<span class="st">"occurrence_year"</span>] <span class="op">==</span> most_recent_year].copy()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Records in </span><span class="sc">{</span>most_recent_year<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(assault_recent)<span class="sc">:,}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Most recent complete year: 2024
Records in 2024: 17,204</code></pre>
</div>
</div>
</section>
<section id="create-season-variable" class="level2">
<h2 class="anchored" data-anchor-id="create-season-variable">5.2 Create season variable</h2>
<div id="create-season-variable" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define seasons based on month</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_season(month):</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> month <span class="kw">in</span> [<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>]:</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Winter"</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> month <span class="kw">in</span> [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]:</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Spring"</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> month <span class="kw">in</span> [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>]:</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Summer"</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> month <span class="kw">in</span> [<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>]:</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Fall"</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>assault_recent[<span class="st">"season"</span>] <span class="op">=</span> assault_recent[<span class="st">"occurrence_month"</span>].<span class="bu">apply</span>(get_season)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Season distribution:"</span>)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(assault_recent[<span class="st">"season"</span>].value_counts().sort_index())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Season distribution:
season
Fall      4394
Spring    4393
Summer    4470
Winter    3947
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="summary-statistics-of-assault-crime-counts-by-season" class="level2">
<h2 class="anchored" data-anchor-id="summary-statistics-of-assault-crime-counts-by-season">5.3 Summary statistics of assault crime counts by season</h2>
<div id="cell-assault-season-summary" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count by season</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>season_counts <span class="op">=</span> assault_recent[<span class="st">"season"</span>].value_counts().sort_index()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>season_summary <span class="op">=</span> season_counts.to_frame(<span class="st">"count"</span>).reset_index()</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>season_summary.columns <span class="op">=</span> [<span class="st">"season"</span>, <span class="st">"count"</span>]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>season_summary[<span class="st">"percentage"</span>] <span class="op">=</span> (season_summary[<span class="st">"count"</span>] <span class="op">/</span> season_summary[<span class="st">"count"</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Summary statistics by season (</span><span class="sc">{</span>most_recent_year<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>display(season_summary)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary statistics by season (2024):</code></pre>
</div>
<div id="assault-season-summary" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Fall</td>
<td>4394</td>
<td>25.54</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Spring</td>
<td>4393</td>
<td>25.53</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Summer</td>
<td>4470</td>
<td>25.98</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Winter</td>
<td>3947</td>
<td>22.94</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="plot-assault-crime-counts-by-season" class="level2">
<h2 class="anchored" data-anchor-id="plot-assault-crime-counts-by-season">5.4 Plot assault crime counts by season</h2>
<div id="cell-plot-assault-crime-season-counts" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar plot of counts by season</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#3498db'</span>, <span class="st">'#2ecc71'</span>, <span class="st">'#e74c3c'</span>, <span class="st">'#f39c12'</span>]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> ax.bar(season_summary[<span class="st">"season"</span>], season_summary[<span class="st">"count"</span>], color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add value labels on bars</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> bar.get_height()</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    ax.text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="fl">2.</span>, height,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f'</span><span class="sc">{</span><span class="bu">int</span>(height)<span class="sc">:,}</span><span class="ss">'</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Season"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Number of Assault Crimes"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f"Assault Crime Counts by Season (</span><span class="sc">{</span>most_recent_year<span class="sc">}</span><span class="ss">)"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_files/figure-html/plot-assault-crime-season-counts-output-1.png" id="plot-assault-crime-season-counts" width="951" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="simple-chi-square-test-for-seasonal-differences" class="level2">
<h2 class="anchored" data-anchor-id="simple-chi-square-test-for-seasonal-differences">5.5 Simple Chi-square test for seasonal differences</h2>
<div id="cell-chi-square-test" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed counts</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>observed <span class="op">=</span> season_summary[<span class="st">"count"</span>].values</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected counts (uniform distribution across 4 seasons)</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>expected <span class="op">=</span> np.full(<span class="dv">4</span>, observed.<span class="bu">sum</span>() <span class="op">/</span> <span class="dv">4</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Chi-square test</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>chi2_stat, p_value <span class="op">=</span> chisquare(f_obs<span class="op">=</span>observed, f_exp<span class="op">=</span>expected)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Chi-square test for seasonal differences:"</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Null hypothesis: Assault crimes are uniformly distributed across seasons"</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Chi-square statistic: </span><span class="sc">{</span>chi2_stat<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  P-value: </span><span class="sc">{</span>p_value<span class="sc">:.4e}</span><span class="ss">"</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Degrees of freedom: </span><span class="sc">{</span><span class="bu">len</span>(observed) <span class="op">-</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate residuals to identify which seasons differ from expected</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>season_summary[<span class="st">"expected"</span>] <span class="op">=</span> expected</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>season_summary[<span class="st">"residual"</span>] <span class="op">=</span> observed <span class="op">-</span> expected</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>season_summary[<span class="st">"standardized_residual"</span>] <span class="op">=</span> (observed <span class="op">-</span> expected) <span class="op">/</span> np.sqrt(expected)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Season-specific deviations from expected:"</span>)</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>display(season_summary[[<span class="st">"season"</span>, <span class="st">"count"</span>, <span class="st">"expected"</span>, <span class="st">"residual"</span>, <span class="st">"standardized_residual"</span>]])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chi-square test for seasonal differences:
  Null hypothesis: Assault crimes are uniformly distributed across seasons
  Chi-square statistic: 39.76
  P-value: 1.2003e-08
  Degrees of freedom: 3

Season-specific deviations from expected:</code></pre>
</div>
<div id="chi-square-test" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">expected</th>
<th data-quarto-table-cell-role="th">residual</th>
<th data-quarto-table-cell-role="th">standardized_residual</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Fall</td>
<td>4394</td>
<td>4301.0</td>
<td>93.0</td>
<td>1.418072</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Spring</td>
<td>4393</td>
<td>4301.0</td>
<td>92.0</td>
<td>1.402824</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Summer</td>
<td>4470</td>
<td>4301.0</td>
<td>169.0</td>
<td>2.576926</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Winter</td>
<td>3947</td>
<td>4301.0</td>
<td>-354.0</td>
<td>-5.397822</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Interpretation:</strong> The chi-square test shows strong evidence against the null hypothesis of uniform distribution (χ² = 39.76, p &lt; 0.05), indicating significant seasonal variation in assault crimes in 2024. Note, with standardized residuals exceeding the threshold of <span class="math inline">\(|2|\)</span>, it is evident that <strong>Summer</strong> has notably <strong>higher</strong> counts than expected, while <strong>Winter</strong> has <strong>lower</strong> counts than expected.</p>
</section>
</section>
<section id="step-6.-examine-seasonality-day-vs-night" class="level1">
<h1>Step 6. Examine seasonality, day vs night</h1>
<section id="summarize-crime-counts-by-hour" class="level2">
<h2 class="anchored" data-anchor-id="summarize-crime-counts-by-hour">6.1 Summarize crime counts by hour</h2>
<div id="cell-assault-crime-counts-by-hour" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count crimes by hour</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>hour_counts <span class="op">=</span> assault_recent[<span class="st">"hour"</span>].value_counts().sort_index()</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Crime counts by hour:"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>display(hour_counts.to_frame(<span class="st">"count"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Crime counts by hour:</code></pre>
</div>
<div id="assault-crime-counts-by-hour" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1217</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>565</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>511</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>420</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>271</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>237</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>219</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>342</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>526</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>646</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>691</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>761</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>1075</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>800</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>806</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>1019</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>934</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>906</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>932</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>849</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>912</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>901</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>861</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>803</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="create-daynight-indicator" class="level2">
<h2 class="anchored" data-anchor-id="create-daynight-indicator">6.2 Create day/night indicator</h2>
<p><strong>Day/Night Definition:</strong> - <strong>Day</strong>: 6:00 AM to 5:59 PM (hours 6-17) - <strong>Night</strong>: 6:00 PM to 5:59 AM (hours 18-23, 0-5)</p>
<div id="create-day-night-indicator-variable" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_time_period(hour):</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">6</span> <span class="op">&lt;=</span> hour <span class="op">&lt;=</span> <span class="dv">17</span>:</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Day"</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Night"</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>assault_recent[<span class="st">"time_period"</span>] <span class="op">=</span> assault_recent[<span class="st">"hour"</span>].<span class="bu">apply</span>(get_time_period)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Check distribution</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Day/Night distribution:"</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(assault_recent[<span class="st">"time_period"</span>].value_counts())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Day/Night distribution:
time_period
Day      8725
Night    8479
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="create-season-daynight-contingency-table" class="level2">
<h2 class="anchored" data-anchor-id="create-season-daynight-contingency-table">6.3 Create season × day/night contingency table</h2>
<div id="season-day-night-contingency-table" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create contingency table</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>contingency_table <span class="op">=</span> pd.crosstab(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    assault_recent[<span class="st">"season"</span>],</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    assault_recent[<span class="st">"time_period"</span>],</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    margins<span class="op">=</span><span class="va">True</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Season × Day/Night Contingency Table:"</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>display(contingency_table)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate proportions within each season (row percentages)</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>contingency_pct <span class="op">=</span> pd.crosstab(</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    assault_recent[<span class="st">"season"</span>],</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    assault_recent[<span class="st">"time_period"</span>],</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    normalize<span class="op">=</span><span class="st">"index"</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Percentage of Day/Night within each season:"</span>)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>display(contingency_pct.<span class="bu">round</span>(<span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Season × Day/Night Contingency Table:</code></pre>
</div>
<div id="season-day-night-contingency-table-1" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">time_period</th>
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Night</th>
<th data-quarto-table-cell-role="th">All</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Fall</th>
<td>2285</td>
<td>2109</td>
<td>4394</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Spring</th>
<td>2251</td>
<td>2142</td>
<td>4393</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Summer</th>
<td>2150</td>
<td>2320</td>
<td>4470</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Winter</th>
<td>2039</td>
<td>1908</td>
<td>3947</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">All</th>
<td>8725</td>
<td>8479</td>
<td>17204</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Percentage of Day/Night within each season:</code></pre>
</div>
<div id="season-day-night-contingency-table-2" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">time_period</th>
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Night</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Fall</th>
<td>52.00</td>
<td>48.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Spring</th>
<td>51.24</td>
<td>48.76</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Summer</th>
<td>48.10</td>
<td>51.90</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Winter</th>
<td>51.66</td>
<td>48.34</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="visualize-the-contingency-table" class="level2">
<h2 class="anchored" data-anchor-id="visualize-the-contingency-table">6.4 Visualize the contingency table</h2>
<div id="cell-visualize-contingency-table" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for grouped bar chart</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>contingency_plot <span class="op">=</span> pd.crosstab(</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    assault_recent[<span class="st">"season"</span>],</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    assault_recent[<span class="st">"time_period"</span>]</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create grouped bar chart</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Subplot 1: Counts</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>contingency_plot.plot(kind<span class="op">=</span><span class="st">'bar'</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>], color<span class="op">=</span>[<span class="st">'#f39c12'</span>, <span class="st">'#34495e'</span>], alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Season"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Number of Crimes"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Assault Crimes by Season and Time Period (Counts)"</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend(title<span class="op">=</span><span class="st">"Time Period"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Subplot 2: Proportions</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>contingency_pct.plot(kind<span class="op">=</span><span class="st">'bar'</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>], color<span class="op">=</span>[<span class="st">'#f39c12'</span>, <span class="st">'#34495e'</span>], alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Season"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Percentage (%)"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Day vs Night Distribution by Season (Proportions)"</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(<span class="dv">50</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'50% mark'</span>)</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend(title<span class="op">=</span><span class="st">"Time Period"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_files/figure-html/visualize-contingency-table-output-1.png" id="visualize-contingency-table" width="1335" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="chi-square-test-for-independence" class="level2">
<h2 class="anchored" data-anchor-id="chi-square-test-for-independence">6.5 Chi-square test for independence</h2>
<div id="cell-chi-square-test-of-independence" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform chi-square test of independence</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>contingency_test <span class="op">=</span> pd.crosstab(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    assault_recent[<span class="st">"season"</span>],</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    assault_recent[<span class="st">"time_period"</span>]</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>chi2_stat, p_value, dof, expected <span class="op">=</span> chi2_contingency(contingency_test)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Chi-square test for independence (Season × Day/Night):"</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Null hypothesis: Day/night proportions are independent of season"</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Chi-square statistic: </span><span class="sc">{</span>chi2_stat<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  P-value: </span><span class="sc">{</span>p_value<span class="sc">:.4e}</span><span class="ss">"</span>)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Degrees of freedom: </span><span class="sc">{</span>dof<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate standardized residuals to identify which cells contribute most</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>observed <span class="op">=</span> contingency_test.values</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>std_residuals <span class="op">=</span> (observed <span class="op">-</span> expected) <span class="op">/</span> np.sqrt(expected)</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe with standardized residuals</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>std_resid_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    std_residuals,</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>contingency_test.index,</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>contingency_test.columns</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Standardized residuals (Season × Day/Night):"</span>)</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>display(std_resid_df.<span class="bu">round</span>(<span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chi-square test for independence (Season × Day/Night):
  Null hypothesis: Day/night proportions are independent of season
  Chi-square statistic: 17.05
  P-value: 6.8914e-04
  Degrees of freedom: 3

Standardized residuals (Season × Day/Night):</code></pre>
</div>
<div id="chi-square-test-of-independence" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">time_period</th>
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Night</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Fall</th>
<td>1.20</td>
<td>-1.22</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Spring</th>
<td>0.49</td>
<td>-0.50</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Summer</th>
<td>-2.46</td>
<td>2.49</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Winter</th>
<td>0.83</td>
<td>-0.85</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Interpretation:</strong></p>
<p>I used a <strong>chi-square test of independence</strong> on the <strong>season × day/night</strong> contingency table to test whether the <em>proportion</em> of day vs night crimes is the same across seasons (null hypothesis: independent). Since p &lt; 0.05, we reject the null. So yes, it is evident that the day/night distribution differs by season.</p>
<p>Then I used standardized residuals (<span class="math inline">\(|residual| &gt; 2\)</span>) to identify which season/time cells differ most from the expected counts under independence.</p>
<p>Therefore, <strong>Summer</strong> looks most different, with <strong>fewer Day</strong> crimes than expected and <strong>more Night</strong> crimes than expected (standardized residuals: Day = −2.46, Night = +2.49).</p>
</section>
</section>
<section id="step-7.-look-at-neighbourhood-patterns" class="level1">
<h1>Step 7. Look at neighbourhood patterns</h1>
</section>
<section id="step-8.-create-a-map" class="level1">
<h1>Step 8. Create a map</h1>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>
</section>

</main>
<!-- /main column -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../..";
window._ojs.paths.runtimeToRoot = "../../../../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>